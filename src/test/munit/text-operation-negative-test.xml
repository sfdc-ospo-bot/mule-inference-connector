<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<mule xmlns="http://www.mulesoft.org/schema/mule/core"
	  xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	  xmlns:munit="http://www.mulesoft.org/schema/mule/munit"
	  xmlns:ms-inference="http://www.mulesoft.org/schema/mule/ms-inference"
	  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	  xsi:schemaLocation="
	  http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
	  http://www.mulesoft.org/schema/mule/munit http://www.mulesoft.org/schema/mule/munit/current/mule-munit.xsd
	  http://www.mulesoft.org/schema/mule/ms-inference http://www.mulesoft.org/schema/mule/ms-inference/current/mule-ms-inference.xsd">

	<munit:config name="text-operation-negative-test.xml" />

	<!-- Chat answer prompt tests-->
	<munit:test doc:id="b3144fa3-60d9-41f1-9c26-ab5eae501685" name="chat_invalid-model-Test" expectedErrorType="ms-inference:CHAT_OPERATION_FAILURE">
		<munit:execution>
			<ms-inference:chat-answer-prompt doc:name="[CHAT] Answer Prompt" doc:id="8c08db9d-91a5-4771-959e-751cf848093e" config-ref="OpenAIInvalidModelConfig">
				<ms-inference:prompt ><![CDATA[#['Some payload']]]></ms-inference:prompt>
			</ms-inference:chat-answer-prompt>
		</munit:execution>
	</munit:test>

	<munit:test doc:id="b3144fa3-60d9-41f1-9c26-ab5eae501685" name="chat_invalid-request-Test_vertexaiexpress"
				expectedErrorType="ms-inference:CHAT_OPERATION_FAILURE">
		<munit:execution>
			<ms-inference:chat-answer-prompt doc:name="[CHAT] Answer Prompt" doc:id="8c08db9d-91a5-4771-959e-751cf848093e"
											 config-ref="VertexAiExpressConfigInvalidModel">
				<ms-inference:prompt ><![CDATA[#["What is the capital of Germany?"]]]></ms-inference:prompt>
			</ms-inference:chat-answer-prompt>
		</munit:execution>
	</munit:test>

	<munit:test doc:id="b3144fa3-60d9-41f1-9c26-ab5eae501685" name="chat_invalid-base-url-Test" expectedErrorType="ms-inference:CHAT_OPERATION_FAILURE">
		<munit:execution>
			<ms-inference:chat-answer-prompt doc:name="[CHAT] Answer Prompt" doc:id="8c08db9d-91a5-4771-959e-751cf848093e" config-ref="XInferenceInvalidConfig">
				<ms-inference:prompt ><![CDATA[#['Some payload']]]></ms-inference:prompt>
			</ms-inference:chat-answer-prompt>
		</munit:execution>
	</munit:test>

	<munit:test doc:id="b3144fa3-60d9-41f1-9c26-ab5eae501685" name="chat_failure_withopenai_omodels" expectedErrorType="ms-inference:CHAT_OPERATION_FAILURE">
		<munit:execution>
			<ms-inference:chat-answer-prompt doc:name="[CHAT] Answer Prompt" doc:id="8c08db9d-91a5-4771-959e-751cf848093e"
											 config-ref="OpenAIConfigWithO4MiniModelAndInvalidAPIKey">
				<ms-inference:prompt ><![CDATA[#['Some payload']]]></ms-inference:prompt>
			</ms-inference:chat-answer-prompt>
		</munit:execution>
	</munit:test>

	<!-- Agent define prompt template tests-->
	<munit:test doc:id="b3144fa3-60d9-41f1-9c26-ab5eae501685" name="agent-define-prompt-invalid-model-Test" expectedErrorType="ms-inference:CHAT_OPERATION_FAILURE">
		<munit:execution>
			<ms-inference:agent-define-prompt-template doc:name="[Agent] Define Prompt Template" doc:id="d4f74b68-3202-4154-b0ee-1489ef42e870" config-ref="OpenAIInvalidModelConfig">
				<ms-inference:template ><![CDATA[#['Some payload']]]></ms-inference:template>
				<ms-inference:instructions ><![CDATA[#['Some payload']]]></ms-inference:instructions>
				<ms-inference:data ><![CDATA[#['Some payload']]]></ms-inference:data>
			</ms-inference:agent-define-prompt-template>
		</munit:execution>
	</munit:test>

	<munit:test doc:id="b3144fa3-60d9-41f1-9c26-ab5eae501685" name="agent-define-prompt-invalid-base-url-Test" expectedErrorType="ms-inference:CHAT_OPERATION_FAILURE">
		<munit:execution>
			<ms-inference:agent-define-prompt-template doc:name="[Agent] Define Prompt Template" doc:id="d4f74b68-3202-4154-b0ee-1489ef42e870" config-ref="XInferenceInvalidConfig">
				<ms-inference:template ><![CDATA[#['Some payload']]]></ms-inference:template>
				<ms-inference:instructions ><![CDATA[#['Some payload']]]></ms-inference:instructions>
				<ms-inference:data ><![CDATA[#['Some payload']]]></ms-inference:data>
			</ms-inference:agent-define-prompt-template>
		</munit:execution>
	</munit:test>

	<!-- Chat completion tests-->
	<munit:test doc:id="b3144fa3-60d9-41f1-9c26-ab5eae501685" name="chat_completion-invalid-model-Test" expectedErrorType="ms-inference:CHAT_OPERATION_FAILURE">
		<munit:execution>
			<ms-inference:chat-completions doc:name="[Chat] Completions" doc:id="80433396-b05a-4ca6-8e89-18845c897cf8" config-ref="OpenAIInvalidModelConfig">
				<ms-inference:messages ><![CDATA[#['Some payload']]]></ms-inference:messages>
			</ms-inference:chat-completions>
		</munit:execution>
	</munit:test>

	<munit:test doc:id="b3144fa3-60d9-41f1-9c26-ab5eae501685" name="chat-completion-invalid-base-url-Test" expectedErrorType="ms-inference:CHAT_OPERATION_FAILURE">
		<munit:execution>
			<ms-inference:chat-completions doc:name="[Chat] Completions" doc:id="80433396-b05a-4ca6-8e89-18845c897cf8" config-ref="XInferenceInvalidConfig">
				<ms-inference:messages ><![CDATA[#['Some payload']]]></ms-inference:messages>
			</ms-inference:chat-completions>
		</munit:execution>
	</munit:test>

	<munit:test doc:id="b3144fa3-60d9-41f1-9c26-ab5eae501685" name="chat_completion-invalid-model-Test_vertexaiexpress" expectedErrorType="ms-inference:CHAT_OPERATION_FAILURE">
		<munit:execution>
			<ms-inference:chat-completions doc:name="[Chat] Completions" doc:id="80433396-b05a-4ca6-8e89-18845c897cf8" config-ref="VertexAiExpressConfigInvalidModel">
				<ms-inference:messages ><![CDATA[#['Some payload']]]></ms-inference:messages>
			</ms-inference:chat-completions>
		</munit:execution>
	</munit:test>

	<!-- Tools native template tests-->
	<munit:test doc:id="b3144fa3-60d9-41f1-9c26-ab5eae501685" name="tools-native-template-invalid-model-Test" expectedErrorType="ms-inference:TOOLS_OPERATION_FAILURE">
		<munit:execution>
			<ms-inference:tools-native-template
					config-ref="OpenAIInvalidModelConfig">
				<ms-inference:template><![CDATA[#['Some payload']]]></ms-inference:template>
				<ms-inference:instructions><![CDATA[#['Some payload']]]></ms-inference:instructions>
				<ms-inference:data><![CDATA[#['Some payload']]]></ms-inference:data>
				<ms-inference:tools><![CDATA[#['Some payload']]]></ms-inference:tools>
			</ms-inference:tools-native-template>
		</munit:execution>
	</munit:test>

	<munit:test doc:id="b3144fa3-60d9-41f1-9c26-ab5eae501685" name="tools-native-template-invalid-base-url-Test" expectedErrorType="ms-inference:TOOLS_OPERATION_FAILURE">
		<munit:execution>
			<ms-inference:tools-native-template
					config-ref="XInferenceInvalidConfig">
				<ms-inference:template><![CDATA[#['Some payload']]]></ms-inference:template>
				<ms-inference:instructions><![CDATA[#['Some payload']]]></ms-inference:instructions>
				<ms-inference:data><![CDATA[#['Some payload']]]></ms-inference:data>
				<ms-inference:tools><![CDATA[#['Some payload']]]></ms-inference:tools>
			</ms-inference:tools-native-template>
		</munit:execution>
	</munit:test>

	<munit:test doc:id="b3144fa3-60d9-41f1-9c26-ab5eae501685" name="tools-native-template-missing_operation_vertexaiexpress" expectedErrorType="ms-inference:TOOLS_OPERATION_FAILURE">
		<munit:execution>
			<ms-inference:tools-native-template
					config-ref="VertexAiExpressConfig">
				<ms-inference:template><![CDATA[#['Some payload']]]></ms-inference:template>
				<ms-inference:instructions><![CDATA[#['Some payload']]]></ms-inference:instructions>
				<ms-inference:data><![CDATA[#['Some payload']]]></ms-inference:data>
				<ms-inference:tools><![CDATA[#['Some payload']]]></ms-inference:tools>
			</ms-inference:tools-native-template>
		</munit:execution>
	</munit:test>


	<!-- Custom header test using negative scenario : shows that actual apikey is overridden by one passed in custom header-->
	<munit:test doc:id="b3144fa3-60d9-41f1-9c26-ab5eae501685" name="chat_custom_header_wrong_api_key_test" expectedErrorType="ms-inference:CHAT_OPERATION_FAILURE">
		<munit:behavior>
			<set-variable value="InvalidAPIKeyValue" doc:name="Set Variable" doc:id="ea8bbd6f-0147-4081-b75f-993f0db6931e" variableName="apikey"/>
		</munit:behavior>
		<munit:execution>
			<ms-inference:chat-answer-prompt doc:name="[CHAT] Answer Prompt" doc:id="8c08db9d-91a5-4771-959e-751cf848093e" config-ref="azureAiFoundryInvalidConfig">
				<ms-inference:prompt ><![CDATA[What is the capital of India?]]></ms-inference:prompt>
			</ms-inference:chat-answer-prompt>
		</munit:execution>
	</munit:test>
</mule>